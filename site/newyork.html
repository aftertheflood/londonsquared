<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: sans-serif;
      }
      p {
        max-width:600px;
      }
      .subtitle {
        font-style:italic;
        color:#666;
      }
      .borough-label {
        fill: #111;
      }
      .borough-label-outline{
        stroke: #FFF;
        stroke-width: 4px;
        stroke-linejoin: round;
      }
      line.tick{
        stroke: #000;
        stroke-width: 1px;
      }
      .ls-background{
        fill:#EEE;
      }
    </style>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="../dist/index.js"></script>
  </head>
  <body>
    <h1>New York</h1>
    <div class="vizualisation-container">

    </div>
  </body>
  <script>
window.onload = ()=>{
  const width = 600;
  const height = 525;

  const svg = d3.select('.vizualisation-container')
    .append('svg')
    .attr('width', width)
    .attr('height', height);

  d3.csv('data/new-york-profiles.csv')
    .then((data)=>{
      const LS = atf.londonSquared({gridGapProportion:(1/13)})
        .data(data, d=>d.Code) //the second argument is an accessor for the local authority code associated with the data row. by default this is d=>d.code
        .width(width)
        .height(height);

      svg.call(LS); // draw the cartogram shapes
      
      const circleScale = d3.scalePow()
        .domain([0, d3.max(data, d => Number(d['population']))])
        .range([0, LS.blockSize()/2])

      console.log(circleScale.domain(), circleScale.range());
      
      LS.masked()
        .call(function(parent){
          parent.append('circle')
            .attr('r', d => {
              console.log(d); 
              return circleScale(d.data['population'])
            })
            .attr('cx', LS.centroid()[0])
            .attr('cy', LS.centroid()[1])
            .attr('fill', '#f00');
        });
      
      LS.foreground()
        .call(function(parent){
          parent.append('text')
            .attr('class', 'borough-label')
            .attr('x', 5)
            .attr('y', 15)
            .text(d => d.LSAbbreviation);
          
          parent.append('text')
            .attr('class', 'borough-label')
            .attr('x', 5)
            .attr('y', LS.blockSize()-5)
            .text(d => `${d.data['population']/1000000}m`);
        })
    })
    .catch(err=>{
      console.log(err);
    })
}
  </script>
</html>