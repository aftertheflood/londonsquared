<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>London Squared</title>
	<link rel="stylesheet" type="text/css" href="css/editor.css">
	<script src="//use.typekit.net/jac3auh.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
	<script type="text/javascript" src="js/paper-full.min.js"></script>
	<script type="text/javascript" src="js/RequestAnimationFrame.js"></script>
	<script type="text/javascript" src="js/Tween.js"></script>
	<script type="text/javascript" src="js/londonsquared.js"></script>
	<script type="text/javascript">

		window.onload = function() {
			/*
			var map = new LondonSquaredMap( { canvas: "londonsquared_canvas",
											 dataURL: "data/londonsquared.json",
											 colour: "#fa402a",
											 tileAnimateTime: 200,
											 delayBetweenTiles: 200 } )
			*/
		}

		function processForm(){

			var form = document.forms["londonsquared_form"] //getElementById("londonsquared_form")

			//console.log( form )

			var boroughs = ["Enf",
						"Hrw","Brn","Hgy","Wth",
						"Hdn","Elg","Brt","Cmd","Isl","Hck","Rdb","Hvg",
						"Hns","Hms","Kns","Wst","Cty","Tow","Nwm","Bar",
						"Rch","Wns","Lam","Swr","Lsh","Grn","Bxl",
						"Kng","Mrt","Crd","Brm",
						"Stn"]

			var str = "";

			var max = 0
			var min = 9007199254740991
			var ret = []
			for( var b=0; b < boroughs.length; b++ ){
				//console.log( "boroughs> " + b + ": " + boroughs[b] + " " + form[b].value )
				var borough = boroughs[b]
				var element = form.elements[borough]

				var o_val = element.value
				var val = parseInt( o_val )
				var norm = 1
				if (isNaN(val)){
					norm = 0
					val = 0 // or should it be ignored if it's empty? Does every borough *have* to have data?
				} else {
					// don't factor empty values into the normalisation
					max = Math.max( val, max )
					min = Math.min( val, min )
				}
				var ob = {   key: borough,
							data: {raw: val, norm: norm, disp: o_val}
						}
				ret.push( ob )
			}
			var diff = max - min
			// deal with diff being 0
			if (diff == 0){
				console.log("processing form - error with values: ",min, max, diff )
				diff = 1
			}
			// normalise the values
			for( var i=0; i< ret.length; i++){
				var ob = ret[i]
				if (ob.data.norm > 0){ // only normalise valid values
					ob.data.norm = ( ob.data.raw - min ) / diff
				}
			}
			// convert data to JSON to pass to the map
			var json = JSON.stringify( {data: ret} )

			var palette = form['palette'].value

			// create a new canvas element (should override the previous one, if one exists).
			var div = document.getElementById('exportedcode')
			div.innerHTML = "<canvas id='londonsquared_editor_canvas' width='900' height='900'></canvas><br />"
			// create an instance of the LondonSquaredMap, passing in the data
			window.londonSquaredMap = new LondonSquaredMap( {
				canvas: 'londonsquared_editor_canvas',
				data: json,
				colour: "#ffffff",
				palette: palette,
				showTitle: true,
				showCredit: true
			} )

		}
		function exportMap(){

			if (window.londonSquaredMap == undefined){
				alert("please enter some values and preview first")
			} else {
				window.londonSquaredMap.exportMapAsPNG()
			}
		}

	</script>

</head>
<body>

	<section id="the-title">
		<h1>London Squared Editor</h1>
	</section>

	<section id="the-form">
		<form id="londonsquared_form" name="londonsquared_form" action="">

			1. Enter data for boroughs here:<br /><br />

			City of London: <input type="text" name="Cty" value="" /><br />
			Barking & Dagenham: <input type="text" name="Bar" value="" /><br />
			Barnet: <input type="text" name="Brn" value="" /><br />
			Bexley: <input type="text" name="Bxl" value="" /><br />
			Brent: <input type="text" name="Brt" value="" /><br />
			Bromley: <input type="text" name="Brm" value="" /><br />
			Camden: <input type="text" name="Cmd" value="" /><br />
			Croydon: <input type="text" name="Crd" value="" /><br />
			Enfield: <input type="text" name="Enf" value="" /><br />
			Ealing: <input type="text" name="Elg" value="" /><br />
			Greenwich: <input type="text" name="Grn" value="" /><br />
			Hackney: <input type="text" name="Hck" value="" /><br />
			Hammersmith & Fulham: <input type="text" name="Hms" value="" /><br />
			Haringay: <input type="text" name="Hgy" value="" /><br />
			Harrow: <input type="text" name="Hrw" value="" /><br />
			Havering: <input type="text" name="Hvg" value="" /><br />
			Hillingdon: <input type="text" name="Hdn" value="" /><br />
			Hounslow: <input type="text" name="Hns" value="" /><br />
			Islington: <input type="text" name="Isl" value="" /><br />
			Kensington: <input type="text" name="Kns" value="" /><br />
			Kingston upon Thames: <input type="text" name="Kng" value="" /><br />
			Lambeth: <input type="text" name="Lam" value="" /><br />
			Lewisham: <input type="text" name="Lsh" value="" /><br />
			Merton: <input type="text" name="Mrt" value="" /><br />
			Newham: <input type="text" name="Nwm" value="" /><br />
			Redbridge: <input type="text" name="Rdb" value="" /><br />
			Richmond: <input type="text" name="Rch" value="" /><br />
			Southwark: <input type="text" name="Swr" value="" /><br />
			Sutton: <input type="text" name="Stn" value="" /><br />
			Tower Hamlets: <input type="text" name="Tow" value="" /><br />
			Waltham Forest: <input type="text" name="Wth" value="" /><br />
			Wandsworth: <input type="text" name="Wns" value="" /><br />
			Westminster: <input type="text" name="Wst" value="" /><br />

			2. Choose colour palette: <select name="palette">
				<option value="green">Green</option>
				<option value="blue">Blue</option>
				<option value="purple">Purple</option>
				<option value="red">Red</option>
				<option value="orange">Orange</option>
			</select><br />

			<a href="javascript:processForm()" onClick="processForm()">3. Preview</a><br />
		</form>

	</section>

	<section id="the-export">
		<div id="exportedcode">

		</div>
		<div>
			<a href='javascript:exportMap();' download='londonsquared.png' onClick='exportMap();'>4. Export</a>
		</div>

	</section>


</body>
</html>
