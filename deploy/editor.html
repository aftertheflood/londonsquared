<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>London Squared</title>
	<link rel="stylesheet" type="text/css" href="css/editor.css">
	<script src="//use.typekit.net/jac3auh.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
	<script type="text/javascript" src="js/paper-full.min.js"></script>
	<script type="text/javascript" src="js/RequestAnimationFrame.js"></script>
	<script type="text/javascript" src="js/Tween.js"></script>
	<script type="text/javascript" src="js/londonsquared.js"></script>
	<script type="text/javascript">

		window.onload = function() {
			/*
			var map = new LondonSquaredMap( { canvas: "londonsquared_canvas",
											 dataURL: "data/londonsquared.json",
											 colour: "#fa402a",
											 tileAnimateTime: 200,
											 delayBetweenTiles: 200 } )
			*/
		}

		function processForm(){

			var form = document.forms["londonsquared_form"] //getElementById("londonsquared_form")

			//console.log( form )

			var boroughs = ["Enf",
						"Hrw","Brn","Hgy","Wth",
						"Hdn","Elg","Brt","Cmd","Isl","Hck","Rdb","Hvg",
						"Hns","Hms","Kns","Wst","Cty","Tow","Nwm","Bar",
						"Rch","Wns","Lam","Swr","Lsh","Grn","Bxl",
						"Kng","Mrt","Crd","Brm",
						"Stn"]

			var str = "";

			var max = 0
			var min = 9007199254740991
			var ret = []
			for( var b=0; b < boroughs.length; b++ ){
				//console.log( "boroughs> " + b + ": " + boroughs[b] + " " + form[b].value )
				var borough = boroughs[b]
				var element = form.elements[borough]

				var o_val = element.value
				var val = parseInt( o_val )
				var norm = 1
				if (isNaN(val)){
					norm = 0
					val = 0 // or should it be ignored if it's empty? Does every borough *have* to have data?
				} else {
					// don't factor empty values into the normalisation
					max = Math.max( val, max )
					min = Math.min( val, min )
				}
				var ob = {   key: borough,
							data: {raw: val, norm: norm, disp: o_val}
						}
				ret.push( ob )
			}
			var diff = max - min
			// deal with diff being 0
			if (diff == 0){
				console.log("processing form - error with values: ",min, max, diff )
				diff = 1
			}
			// normalise the values
			for( var i=0; i< ret.length; i++){
				var ob = ret[i]
				if (ob.data.norm > 0){ // only normalise valid values
					ob.data.norm = ( ob.data.raw - min ) / diff
				}
			}
			// convert data to JSON to pass to the map
			var json = JSON.stringify( {data: ret} )

			var palette = form['palette'].value

			// create a new canvas element (should override the previous one, if one exists).
			var div = document.getElementById('exportedcode')
			div.innerHTML = "<canvas id='londonsquared_editor_canvas' width='900' height='900'></canvas><br />"
			// create an instance of the LondonSquaredMap, passing in the data
			window.londonSquaredMap = new LondonSquaredMap( {
				canvas: 'londonsquared_editor_canvas',
				data: json,
				colour: "#ffffff",
				palette: palette,
				showTitle: true,
				showCredit: true
			} )

		}
		function exportMap(){

			if (window.londonSquaredMap == undefined){
				alert("please enter some values and preview first")
			} else {
				window.londonSquaredMap.exportMapAsPNG()
			}
		}

	</script>

</head>
<body>


	<section id="the-title">
		<h1>London Squared, the Editor</h1>
		<p><a href="http://aftertheflood.co/">Made by After the flood</a></p>
	</section>


	<section id="the-body">


		<!-- The form. May need to add the export button to here -->
		<section id="the-form">
			<form id="londonsquared_form" name="londonsquared_form" action="">

				<section id="borough-data" class="row">
					<h2 class="columns">
						<span class="number-dot">1</span>:&nbsp;Enter your data for each borough
					</h2>
					<p class="hint columns">Hint! You can use your keyboard to tab through the data entry fields below</p>
					<div class="data-fields">
						<div class="borough-field large-4 medium-6 small-12 columns"><label>City of London:</label><input type="text" name="Cty" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Barking & Dagenham:</label><input type="text" name="Bar" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Barnet:</label><input type="text" name="Brn" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Bexley:</label><input type="text" name="Bxl" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Brent:</label><input type="text" name="Brt" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Bromley:</label><input type="text" name="Brm" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Camden:</label><input type="text" name="Cmd" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Croydon:</label><input type="text" name="Crd" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Enfield:</label><input type="text" name="Enf" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Ealing:</label><input type="text" name="Elg" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Greenwich:</label><input type="text" name="Grn" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Hackney:</label><input type="text" name="Hck" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Hammersmith & Fulham:</label><input type="text" name="Hms" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Haringay:</label><input type="text" name="Hgy" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Harrow:</label><input type="text" name="Hrw" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Havering:</label><input type="text" name="Hvg" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Hillingdon:</label><input type="text" name="Hdn" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Hounslow:</label><input type="text" name="Hns" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Islington:</label><input type="text" name="Isl" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Kensington:</label><input type="text" name="Kns" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Kingston upon Thames:</label><input type="text" name="Kng" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Lambeth:</label><input type="text" name="Lam" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Lewisham:</label><input type="text" name="Lsh" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Merton:</label><input type="text" name="Mrt" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Newham:</label><input type="text" name="Nwm" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Redbridge:</label><input type="text" name="Rdb" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Richmond:</label><input type="text" name="Rch" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Southwark:</label><input type="text" name="Swr" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Sutton:</label><input type="text" name="Stn" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Tower Hamlets:</label><input type="text" name="Tow" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Waltham Forest:</label><input type="text" name="Wth" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Wandsworth:</label><input type="text" name="Wns" value="" /></div>
						<div class="borough-field large-4 medium-6 small-12 columns"><label>Westminster:</label><input type="text" name="Wst" value="" /></div>
					</div>
				</section>

				<section id="color-palette" class="row">
					<h2 class="columns">
						<span class="number-dot">2</span>:&nbsp;Choose a colour palette
					</h2>
					<div class="color-selector columns">
						<fieldset class="color-picker">
							<label for="paletteGreen" class="paletteGreen">
								<input type="radio" name="palette" value="green" id="paletteGreen"><span>Green</span>
							</label>
							<label for="paletteBlue" class="paletteBlue">
								<input type="radio" name="palette" value="blue" id="paletteBlue"><span>Blue</span>
							</label>
							<label for="palettePurple" class="palettePurple">
								<input type="radio" name="palette" value="purple" id="palettePurple"><span>Purple</span>
							</label>
							<label for="paletteRed" class="paletteRed">
								<input type="radio" name="palette" value="red" id="paletteRed"><span>Red</span>
							</label>
							<label for="paletteOrange" class="paletteOrange">
								<input type="radio" name="palette" value="orange" id="paletteOrange"><span>Orange</span>
							</label>
						</fieldset>

					</div>
				</section>

				<section id="get-preview" class="row">
					<h2 class="columns">
						<a href="javascript:processForm()" onClick="processForm()">
							<span class="number-dot">3</span>:&nbsp;Generate your map
						</a>
					</h2>
				</section>

			</form>
		</section>
		<!-- end of the form -->



		<section id="the-export" class="row">
			<div id="exportedcode">

			</div>
			<h2 class="columns">
				<a href='javascript:exportMap();' download='londonsquared.png' onClick='exportMap();'>
					<span class="number-dot">4</span>:&nbsp;Export
				</a>
			</h2>
			<p class="hint columns">Hint! You can also right-click on the image to "save image as..."</p>
		</section>

	</section>

	<section id="the-footer">
		<p class="row">© Copyright 2015, After the flood</p>
	</section>

</body>
</html>
